#!/usr/bin/env sh

# Local policy validation (WHY: surface OPA deny reasons before CI)
SCRIPT_DIR="$(dirname "$0")"
REPO_ROOT="$(git rev-parse --show-toplevel)"
VALIDATOR="$REPO_ROOT/scripts/validate-commit.sh"
MSG_FILE="$1"

if [ -f "$VALIDATOR" ]; then
  sh "$VALIDATOR" "$MSG_FILE" || {
    echo "[commit-msg] OPA validation failed; blocking commit." >&2
    exit 1
  }
fi

# Commitlint enforcement
npx commitlint --edit "$1"
# Deprecated husky sourcing lines removed per upgrade guidance.
